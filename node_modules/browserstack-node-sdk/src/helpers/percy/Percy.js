function a71_0x302c(){const _0x281479=['token','createWriteStream','4368976MWRNOU','PERCY_SERVER_ADDRESS','app','hlPIT','sVpJT','version',':start','xWpMx','pipe','start','push','http://localhost:5338','kKHvl','error','createPercyConfig','lSsvJ','api/app_percy/get_project_token?name=','end','YRvWw','BROWSERSTACK_TESTHUB_UUID','SSPKq','3980496HleKDH','isProcessRunning','2dDAfrE','env','776463BYWInR','KISjl','iUZqP','../logger','percyOptions','stderr','IzvZh','exec:stop','../../helpers/performance/constants','stdout','PLUaj','SMJjP','stop','Percy\x20fetch\x20token\x20success','Percy\x20healthcheck\x20successful','1256715azFBGc','323416XJzVxb','exec','stringify','close','isRunning','NpFGM','nodeRequest','DcPio','healthcheck','fetchPercyToken','DOWNLOAD','GET','&type=','fJOUb','42fbITGL','13300983JJQygf','join','writeFile','percy.log','automate','RFDII','ENV_VAR','getBinaryPath','debug','eIYPs','percy.json','child_process','sOPWc','path','umCKC','./PercyBinary','837319wEkOSx'];a71_0x302c=function(){return _0x281479;};return a71_0x302c();}const a71_0x3eba7b=a71_0x513b;(function(_0x373dfb,_0x41d3ba){const _0x1693aa=a71_0x513b,_0x2a6f58=_0x373dfb();while(!![]){try{const _0x35834d=parseInt(_0x1693aa(0x1b2))/0x1*(parseInt(_0x1693aa(0x179))/0x2)+-parseInt(_0x1693aa(0x1b4))/0x3+-parseInt(_0x1693aa(0x1b0))/0x4+parseInt(_0x1693aa(0x178))/0x5+parseInt(_0x1693aa(0x187))/0x6*(-parseInt(_0x1693aa(0x198))/0x7)+parseInt(_0x1693aa(0x19b))/0x8+parseInt(_0x1693aa(0x188))/0x9;if(_0x35834d===_0x41d3ba)break;else _0x2a6f58['push'](_0x2a6f58['shift']());}catch(_0x52f27b){_0x2a6f58['push'](_0x2a6f58['shift']());}}}(a71_0x302c,0x7be70));const fs=require('fs'),path=require(a71_0x3eba7b(0x195)),os=require('os'),{spawn}=require(a71_0x3eba7b(0x193)),helper=require('../helper'),logger=require(a71_0x3eba7b(0x1b7))['winstonLogger'],{logDir}=require('../logger'),testHubConstants=require('../../helpers/testhub/constants'),PerformanceTester=require('../../helpers/performance/performance-tester'),{PERCY_EVENTS:PerformanceEvents}=require(a71_0x3eba7b(0x171)),PercyBinary=require(a71_0x3eba7b(0x197));class Percy{#logfile=path[a71_0x3eba7b(0x189)](logDir,a71_0x3eba7b(0x18b));#address=process['env'][a71_0x3eba7b(0x19c)]||a71_0x3eba7b(0x1a6);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a71_0x3eba7b(0x1b1)]=![];constructor(_0x15c4db){this.#config=_0x15c4db,!!_0x15c4db['app']&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x37bfb1=a71_0x3eba7b;if(!this.#binaryPath){const _0x54c294=new PercyBinary();PerformanceTester[_0x37bfb1(0x1a4)](PerformanceEvents[_0x37bfb1(0x183)]),this.#binaryPath=await _0x54c294[_0x37bfb1(0x18f)](this.#config),PerformanceTester[_0x37bfb1(0x1ac)](PerformanceEvents[_0x37bfb1(0x183)]);}return this.#binaryPath;}async #sleep(_0x59ab1e){return new Promise(_0x326d94=>setTimeout(_0x326d94,_0x59ab1e));}async[a71_0x3eba7b(0x181)](){const _0x2b806b=a71_0x3eba7b,_0x44ca69={};_0x44ca69['fJOUb']=_0x2b806b(0x184),_0x44ca69[_0x2b806b(0x173)]='percy/healthcheck';const _0x230376=_0x44ca69;try{const _0x549053=await helper[_0x2b806b(0x17f)](_0x230376[_0x2b806b(0x186)],_0x230376[_0x2b806b(0x173)],null,null,this.#address);if(_0x549053)return!![];}catch(_0x1e0652){return![];}}async[a71_0x3eba7b(0x1a4)](){const _0x427c39=a71_0x3eba7b,_0x28dd33={'DcPio':'app:exec','umCKC':_0x427c39(0x17a),'HiRBq':function(_0x1316e8,_0x2f1b22,_0x1b362d,_0x3dbdc5){return _0x1316e8(_0x2f1b22,_0x1b362d,_0x3dbdc5);},'SSPKq':_0x427c39(0x17c),'hlPIT':_0x427c39(0x177)},_0x4d7e89=await this.#getBinaryPath(),_0x1324be={};_0x1324be['flags']='a';const _0xd83b1e=fs[_0x427c39(0x19a)](this.#logfile,_0x1324be),_0xc233bd=await this[_0x427c39(0x182)](),_0x823258=await this[_0x427c39(0x1a9)]();if(!_0xc233bd)return![];const _0xd608f7=[(this.#isApp?_0x28dd33[_0x427c39(0x180)]:_0x28dd33[_0x427c39(0x196)])+_0x427c39(0x1a1)];_0x823258&&_0xd608f7[_0x427c39(0x1a5)]('-c',_0x823258);this.#proc=_0x28dd33['HiRBq'](spawn,_0x4d7e89,_0xd608f7,{'env':Object['assign'](process[_0x427c39(0x1b3)],{'PERCY_TOKEN':_0xc233bd,'TH_BUILD_UUID':process[_0x427c39(0x1b3)][testHubConstants[_0x427c39(0x18e)][_0x427c39(0x1ae)]]})}),this.#proc[_0x427c39(0x172)][_0x427c39(0x1a3)](_0xd83b1e),this.#proc[_0x427c39(0x1b9)][_0x427c39(0x1a3)](_0xd83b1e),this[_0x427c39(0x1b1)]=!![];var _0xac471c=this;this.#proc['on'](_0x28dd33[_0x427c39(0x1af)],function(_0x43a034){_0xac471c['isProcessRunning']=![];});do{const _0x130ee9=await this['healthcheck']();if(_0x130ee9)return logger['debug'](_0x28dd33[_0x427c39(0x19e)]),!![];await this.#sleep(0x3e8);}while(this[_0x427c39(0x1b1)]);return![];}async[a71_0x3eba7b(0x175)](){const _0x3489a5=a71_0x3eba7b,_0x2a03ca={'RFDII':function(_0x3dd00e,_0x19c3ef){return _0x3dd00e(_0x19c3ef);},'lSsvJ':function(_0x977649,_0x399b8c,_0x5c1bcb){return _0x977649(_0x399b8c,_0x5c1bcb);},'sOPWc':_0x3489a5(0x170),'eIYPs':_0x3489a5(0x17c)},_0x466b62=await this.#getBinaryPath();return new Promise((_0x18260a,_0xa94085)=>{const _0x6e8f29=_0x3489a5,_0xec3525=_0x2a03ca[_0x6e8f29(0x1aa)](spawn,_0x466b62,[_0x2a03ca[_0x6e8f29(0x194)]]);_0xec3525['on'](_0x2a03ca[_0x6e8f29(0x191)],_0x14fb20=>{const _0x265ef0=_0x6e8f29;this['isProcessRunning']=![],_0x2a03ca[_0x265ef0(0x18d)](_0x18260a,_0x14fb20);});});}[a71_0x3eba7b(0x17d)](){const _0x55f2c0=a71_0x3eba7b;return this[_0x55f2c0(0x1b1)];}async[a71_0x3eba7b(0x182)](){const _0x1d1141=a71_0x3eba7b,_0x22389f={};_0x22389f[_0x1d1141(0x1b5)]=_0x1d1141(0x19d),_0x22389f[_0x1d1141(0x174)]=_0x1d1141(0x18c),_0x22389f['kKHvl']=_0x1d1141(0x184),_0x22389f[_0x1d1141(0x19f)]=_0x1d1141(0x176);const _0x5ccc88=_0x22389f,_0x560b89=this.#config['projectName'];try{const _0x1772a3=this.#isApp?_0x5ccc88[_0x1d1141(0x1b5)]:_0x5ccc88[_0x1d1141(0x174)],_0x141065=await helper['nodeRequest'](_0x5ccc88[_0x1d1141(0x1a7)],_0x1d1141(0x1ab)+_0x560b89+_0x1d1141(0x185)+_0x1772a3,{},this.#config),_0x12c4e3=_0x141065['data'];return logger['debug'](_0x5ccc88[_0x1d1141(0x19f)]),_0x12c4e3[_0x1d1141(0x199)];}catch(_0x16a80e){return logger[_0x1d1141(0x1a8)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x16a80e),null;}}async[a71_0x3eba7b(0x1a9)](){const _0xb7b557=a71_0x3eba7b,_0x108289={'xWpMx':function(_0x43d6eb,_0x13620b){return _0x43d6eb(_0x13620b);},'iUZqP':function(_0x56cbe4,_0x309efe){return _0x56cbe4+_0x309efe;},'YRvWw':'Percy\x20config\x20created\x20at\x20','IzvZh':function(_0x49c7d8,_0x4a6b4b){return _0x49c7d8(_0x4a6b4b);},'NpFGM':_0xb7b557(0x192)};if(!this.#config[_0xb7b557(0x1b8)])return null;const _0x3c148c=path[_0xb7b557(0x189)](os['tmpdir'](),_0x108289[_0xb7b557(0x17e)]),_0x57f157=this.#config['percyOptions'];return!_0x57f157[_0xb7b557(0x1a0)]&&(_0x57f157[_0xb7b557(0x1a0)]='2'),new Promise((_0x3c4f2f,_0x4056a1)=>{const _0x412606=_0xb7b557;fs[_0x412606(0x18a)](_0x3c148c,JSON[_0x412606(0x17b)](_0x57f157),_0x16669a=>{const _0x465956=_0x412606;_0x16669a&&(logger[_0x465956(0x1a8)]('Error\x20creating\x20percy\x20config:\x20'+_0x16669a),_0x108289[_0x465956(0x1a2)](_0x3c4f2f,null)),logger[_0x465956(0x190)](_0x108289[_0x465956(0x1b6)](_0x108289[_0x465956(0x1ad)],_0x3c148c)),_0x108289[_0x465956(0x16f)](_0x3c4f2f,_0x3c148c);});});}}function a71_0x513b(_0x181b40,_0x3a868a){const _0x302ce7=a71_0x302c();return a71_0x513b=function(_0x513b92,_0x2541d3){_0x513b92=_0x513b92-0x16f;let _0x2f20f0=_0x302ce7[_0x513b92];return _0x2f20f0;},a71_0x513b(_0x181b40,_0x3a868a);}module['exports']=Percy;