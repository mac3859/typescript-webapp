const a89_0x4b614f=a89_0xe555;(function(_0x5aafa0,_0x32478d){const _0x44d3e6=a89_0xe555,_0x4b43df=_0x5aafa0();while(!![]){try{const _0x27cb8e=parseInt(_0x44d3e6(0x12b))/0x1*(parseInt(_0x44d3e6(0x120))/0x2)+parseInt(_0x44d3e6(0x152))/0x3+-parseInt(_0x44d3e6(0x10c))/0x4+-parseInt(_0x44d3e6(0x125))/0x5*(parseInt(_0x44d3e6(0x13b))/0x6)+-parseInt(_0x44d3e6(0x10a))/0x7+parseInt(_0x44d3e6(0x148))/0x8+-parseInt(_0x44d3e6(0x117))/0x9;if(_0x27cb8e===_0x32478d)break;else _0x4b43df['push'](_0x4b43df['shift']());}catch(_0x227d21){_0x4b43df['push'](_0x4b43df['shift']());}}}(a89_0x3410,0xc9863));function a89_0x3410(){const _0x5d9e0f=['setAccessibilityVariables','BROWSERSTACK_TEST_OBSERVABILITY','BROWSERSTACK_BUILD_RUN_IDENTIFIER','config','status','ACCESSIBILITY','vVmRs','resolve','env','POST','isBrowserstackInfra','\x20framework','buildStopSent','extractDataFromResponse','/stop','allowScreenshot','error','auth','getConfig','1549009QskhCh','CPBrP','2467748gfeLtF','generateBuildUpstreamData','logBuildError','wJTvx','../performance/constants','isUndefined','BROWSERSTACK_TESTHUB_UUID','getUserName','checkAndSetupPercy','stopBuildUpstream\x20event\x20successful!','getInstance','505638OKiSkA','eUlkt','zGPXL','basename','wcXgr','getFrameworkDetails','job_id','toISOString','../test-observability/utils','817860rgzGKO','vfbcn','../performance/performance-tester.js','ENV_VAR','includes','10590RATPBq','waitForBuildStatus','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','getGitMetaData','authToken','4fvWYUI','../logger','root_dir_path','uploadPending','WhPFS','UkASu','BsxqT','measureWrapper','BS_TESTOPS_BUILD_COMPLETED','./constants.js','RlZtf','user_killed','PUT','iExtD','getProductMap','TESTHUB_BUILD_API','4206kRQLnL','message','OBSERVABILITY','HDjnc','accessibilityOptions','response','WlsBO','BROWSERSTACK_PRODUCT_MAP','getAccessibilityOptions','path','evETz','BROWSERSTACK_ACCESSIBILITY','push','11806400PkTtxA','stringify','false','buildName','pGdXx','STOP','settings','null','nGfeQ','qfIeT','279141ExhqcX','BROWSERSTACK_TESTHUB_JWT','data','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','buildHashedId','projectName','stop','debug','success','setupPercy'];a89_0x3410=function(){return _0x5d9e0f;};return a89_0x3410();}const bsSetupHelper=require('../helper'),path=require(a89_0x4b614f(0x144)),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a89_0x4b614f(0x11f)),testhubUtils=require('./utils.js'),testHubConstants=require(a89_0x4b614f(0x134)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require('../test-observability/requestQueueHandler.js'),logger=require(a89_0x4b614f(0x12c))['winstonLogger'],SessionHandler=require('../test-observability/sessionHandler.js'),PerformanceTester=require(a89_0x4b614f(0x122)),{TESTHUB_EVENTS:PerformanceEvents}=require(a89_0x4b614f(0x110));class TestHubHandler{static [a89_0x4b614f(0x103)]=![];static async['launchBuild'](_0x251adf,_0x131e3a){const _0x88189d=a89_0x4b614f,_0xca4ea6={'wcXgr':function(_0x3eafa4,_0x45037c){return _0x3eafa4||_0x45037c;},'UkASu':function(_0xf6f0c5,_0x58e5a3){return _0xf6f0c5||_0x58e5a3;},'WsuOW':function(_0x3113cb,_0x554492){return _0x3113cb===_0x554492;},'WhPFS':function(_0x5bf679){return _0x5bf679();},'zGPXL':_0x88189d(0x127),'hClVX':_0x88189d(0x14a),'PNlBQ':_0x88189d(0x155),'WlsBO':function(_0x4c42f7,_0x43754f,_0x3c2960,_0x1f1383,_0x164716){return _0x4c42f7(_0x43754f,_0x3c2960,_0x1f1383,_0x164716);},'FlsjU':_0x88189d(0x100)};await PerformanceTester[_0x88189d(0x132)](PerformanceEvents['START'],async()=>{const _0x5a1ed5=_0x88189d,_0xb4f70a={};_0xb4f70a[_0x5a1ed5(0x12d)]='';const _0x4a1263=Object['assign']({},_0x131e3a[_0x5a1ed5(0xfa)],_0xb4f70a),_0x1141fd=bsSetupHelper[_0x5a1ed5(0x113)](_0x4a1263),_0x1093a3=bsSetupHelper['getAccessKey'](_0x4a1263),_0x4a1684=_0xca4ea6[_0x5a1ed5(0x11b)](_0x1141fd,'')+':'+_0xca4ea6[_0x5a1ed5(0x130)](_0x1093a3,''),_0x691bae=testhubUtils[_0x5a1ed5(0x139)](_0x4a1263);process[_0x5a1ed5(0xff)][_0x5a1ed5(0x142)]=JSON[_0x5a1ed5(0x149)](_0x691bae);if(_0xca4ea6['WsuOW'](_0x4a1684,':'))return _0xca4ea6[_0x5a1ed5(0x12f)](isTestObservabilitySession)&&(logger[_0x5a1ed5(0x159)](_0xca4ea6[_0x5a1ed5(0x119)]),process[_0x5a1ed5(0xff)][_0x5a1ed5(0x133)]=_0xca4ea6['hClVX']),testhubUtils['isAccessibilityEnabled'](_0x4a1263)&&logger[_0x5a1ed5(0x159)](_0xca4ea6['PNlBQ']),[null,null];try{const _0x361c0e=await this[_0x5a1ed5(0x10d)](_0x4a1263,_0x251adf),_0x51121b=this[_0x5a1ed5(0x109)](_0x1141fd,_0x1093a3),_0x3b9b7f=await _0xca4ea6[_0x5a1ed5(0x141)](nodeRequest,_0xca4ea6['FlsjU'],testHubConstants[_0x5a1ed5(0x13a)],_0x361c0e,_0x51121b);await this[_0x5a1ed5(0x114)](_0x131e3a,_0x251adf);const _0xf3ba2=this[_0x5a1ed5(0x104)](_0x4a1263,_0x3b9b7f,_0x51121b);return _0xf3ba2;}catch(_0x20cb7b){if(_0xca4ea6['WsuOW'](_0x20cb7b['success'],![])){testhubUtils[_0x5a1ed5(0x10e)](_0x20cb7b);return;}}})();}static async[a89_0x4b614f(0x114)](_0x2f21e6,_0x20eff7){const _0x20a0f4=a89_0x4b614f;if(constants['PERCY_SUPPORTED_FRAMEWORKS'][_0x20a0f4(0x124)](_0x20eff7)){await _0x2f21e6[_0x20a0f4(0x15b)]();return;}_0x2f21e6[_0x20a0f4(0xfa)]['percy']&&logger['debug']('Percy\x20is\x20not\x20supported\x20for\x20'+_0x20eff7+_0x20a0f4(0x102));}static[a89_0x4b614f(0x143)](_0x518c51){const _0x5d7974=a89_0x4b614f,_0x4c54bb={};_0x4c54bb[_0x5d7974(0x14e)]=_0x518c51[_0x5d7974(0x13f)];const _0x2e9dfe=_0x4c54bb;return _0x2e9dfe;}static[a89_0x4b614f(0x109)](_0x117b54,_0x3bbabf){const _0x4c533c={'lCWsT':function(_0x45b10c,_0x201939){return _0x45b10c(_0x201939);}},_0x43d13c={};return _0x43d13c['username']=_0x117b54,_0x43d13c['password']=_0x3bbabf,{'auth':_0x43d13c,'headers':_0x4c533c['lCWsT'](getDefaultHeaders,![])};}static async[a89_0x4b614f(0x10d)](_0x54feba,_0x1943dc){const _0x265d23=a89_0x4b614f,_0x3ce911={'cuRWS':function(_0x4ed610,_0x3a14f6){return _0x4ed610(_0x3a14f6);}},_0xc7a49b={'project_name':_0x54feba[_0x265d23(0x157)]||'','name':_0x54feba[_0x265d23(0x14b)]||path[_0x265d23(0x11a)](path[_0x265d23(0xfe)](process['cwd']())),'build_identifier':_0x54feba['buildIdentifier'],'description':_0x54feba['buildDescription']||'','started_at':new Date()[_0x265d23(0x11e)](),'tags':_0x3ce911['cuRWS'](getCustomTags,_0x54feba),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper['getCiInfo'](),'build_run_identifier':process[_0x265d23(0xff)][_0x265d23(0xf9)],'failed_tests_rerun':process[_0x265d23(0xff)]['BROWSERSTACK_RERUN']||![],'version_control':await bsSetupHelper[_0x265d23(0x129)](),'accessibility':this[_0x265d23(0x143)](_0x54feba),'framework_details':testhubUtils[_0x265d23(0x11c)](_0x54feba,_0x1943dc),'product_map':testhubUtils[_0x265d23(0x139)](_0x54feba),'browserstackAutomation':bsSetupHelper[_0x265d23(0x101)]()};if(process[_0x265d23(0xff)]['BROWSERSTACK_CENTRAL_USER']){const _0x13212b={};_0x13212b[_0x265d23(0x11d)]=process[_0x265d23(0xff)]['BROWSERSTACK_CENTRAL_SCANNER_JOBID'],_0x13212b['token']=process[_0x265d23(0xff)]['BROWSERSTACK_CENTRAL_SCANNER_JWT'],_0xc7a49b['central_scanner']=_0x13212b;}return _0xc7a49b;}static[a89_0x4b614f(0x104)](_0x41559c,_0x1d2f1a,_0x1fa7ac){const _0x3107cd=a89_0x4b614f,_0xa6637d={'zinyW':function(_0x397379){return _0x397379();},'iExtD':function(_0x5f0c84,_0x1b98ef){return _0x5f0c84&&_0x1b98ef;},'HDjnc':'true','nGfeQ':_0x3107cd(0x14a),'evETz':function(_0x3f0fb1,_0x346eba){return _0x3f0fb1&&_0x346eba;}},_0x174aa6={};if(_0xa6637d['zinyW'](isTestObservabilitySession)){const [_0x53c0e2,_0x5e8565,_0x29377a]=testhubUtils['setTestObservabilityVariables'](_0x1d2f1a[_0x3107cd(0x154)],_0x1fa7ac[_0x3107cd(0x108)]);if(_0xa6637d[_0x3107cd(0x138)](_0x53c0e2,_0x5e8565)){const _0x534b2b={};_0x534b2b['jwt']=_0x53c0e2,_0x534b2b[_0x3107cd(0x156)]=_0x5e8565,_0x534b2b[_0x3107cd(0x106)]=_0x29377a,_0x174aa6[testHubConstants[_0x3107cd(0x13d)]]=_0x534b2b,process[_0x3107cd(0xff)][_0x3107cd(0xf8)]=_0xa6637d[_0x3107cd(0x13e)];}else _0x174aa6[testHubConstants['OBSERVABILITY']]={},process[_0x3107cd(0xff)]['BROWSERSTACK_TEST_OBSERVABILITY']=_0xa6637d[_0x3107cd(0x150)];}else process[_0x3107cd(0xff)][_0x3107cd(0xf8)]=_0xa6637d[_0x3107cd(0x150)];if(testhubUtils['isAccessibilityEnabled'](_0x41559c)){const [_0x29868c,_0x86fb3e]=testhubUtils[_0x3107cd(0x15c)](_0x1d2f1a['data']);if(_0xa6637d[_0x3107cd(0x145)](_0x29868c,_0x86fb3e)){const _0x5322c4={};_0x5322c4[_0x3107cd(0x12a)]=_0x29868c,_0x5322c4[_0x3107cd(0x156)]=_0x86fb3e,_0x174aa6[testHubConstants[_0x3107cd(0xfc)]]=_0x5322c4,process['env'][_0x3107cd(0x146)]=_0xa6637d['HDjnc'];}else _0x174aa6[testHubConstants[_0x3107cd(0xfc)]]={},process['env']['BROWSERSTACK_ACCESSIBILITY']=_0xa6637d[_0x3107cd(0x150)];}else process[_0x3107cd(0xff)][_0x3107cd(0x146)]=_0xa6637d[_0x3107cd(0x150)];return testhubUtils['setTestHubCommonMetaInfo'](_0x1d2f1a[_0x3107cd(0x154)]),_0x174aa6;}static async[a89_0x4b614f(0x158)](_0x29bfd5){const _0xa29ce8=a89_0x4b614f,_0x203cd5={'pGdXx':function(_0x867c24,_0x14b0b9){return _0x867c24===_0x14b0b9;},'wYaCk':_0xa29ce8(0x14a),'eUlkt':_0xa29ce8(0x14f),'qfIeT':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','vfbcn':_0xa29ce8(0x107),'fgeDQ':'Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','BsxqT':'finished_metadata','QELDv':_0xa29ce8(0x136),'RlZtf':function(_0x242958){return _0x242958();},'vVmRs':function(_0x136e49,_0x13dcfa,_0x400319,_0x1ec2d7,_0x335c9e,_0x11a681){return _0x136e49(_0x13dcfa,_0x400319,_0x1ec2d7,_0x335c9e,_0x11a681);},'wJTvx':_0xa29ce8(0x137),'SAqKZ':_0xa29ce8(0x115),'CPBrP':_0xa29ce8(0x15a)};await PerformanceTester[_0xa29ce8(0x132)](PerformanceEvents[_0xa29ce8(0x14d)],async()=>{const _0x44869d=_0xa29ce8;if(_0x203cd5[_0x44869d(0x14c)](process[_0x44869d(0xff)][_0x44869d(0x133)],_0x203cd5['wYaCk'])||TestHubHandler[_0x44869d(0x103)]||bsSetupHelper[_0x44869d(0x111)](process[_0x44869d(0xff)][testHubConstants['ENV_VAR'][_0x44869d(0x153)]]))return;TestHubHandler[_0x44869d(0x103)]=!![],await RequestQueueHandler[_0x44869d(0x116)]()[_0x44869d(0x12e)](),await SessionHandler[_0x44869d(0x126)]();if(_0x203cd5[_0x44869d(0x14c)](process[_0x44869d(0xff)][testHubConstants[_0x44869d(0x123)][_0x44869d(0x153)]],_0x203cd5['eUlkt'])||_0x203cd5[_0x44869d(0x14c)](process['env'][testHubConstants['ENV_VAR'][_0x44869d(0x112)]],_0x203cd5[_0x44869d(0x118)])){logger[_0x44869d(0x159)](_0x203cd5[_0x44869d(0x151)]);const _0x1aa28f={};return _0x1aa28f['status']=_0x203cd5[_0x44869d(0x121)],_0x1aa28f[_0x44869d(0x13c)]=_0x203cd5['fgeDQ'],_0x1aa28f;}const _0x56d457={'finished_at':new Date()[_0x44869d(0x11e)](),'finished_metadata':[]};!!_0x29bfd5&&_0x56d457[_0x203cd5[_0x44869d(0x131)]][_0x44869d(0x147)]({'reason':_0x203cd5['QELDv'],'signal':_0x29bfd5,'failure_data':''});const _0x2885fd={'headers':_0x203cd5[_0x44869d(0x135)](getDefaultHeaders)};try{const _0x2e1af0=await _0x203cd5[_0x44869d(0xfd)](nodeRequest,_0x203cd5[_0x44869d(0x10f)],'api/v1/builds/'+process['env'][testHubConstants[_0x44869d(0x123)][_0x44869d(0x112)]]+_0x44869d(0x105),_0x56d457,_0x2885fd,![]);if(_0x2e1af0[_0x44869d(0x154)]&&_0x2e1af0[_0x44869d(0x154)][_0x44869d(0x107)]){const _0x5be509={};_0x5be509[_0x44869d(0x13c)]=_0x2e1af0[_0x44869d(0x154)][_0x44869d(0x107)];throw _0x5be509;}else{logger[_0x44869d(0x159)](_0x203cd5['SAqKZ']);const _0x503bbf={};return _0x503bbf[_0x44869d(0xfb)]=_0x203cd5[_0x44869d(0x10b)],_0x503bbf[_0x44869d(0x13c)]='',_0x503bbf;}}catch(_0x2f4b53){_0x2f4b53['response']?logger[_0x44869d(0x159)](_0x44869d(0x128)+_0x2f4b53[_0x44869d(0x140)][_0x44869d(0xfb)]+'\x20'+_0x2f4b53[_0x44869d(0x140)]['statusText']+'\x20'+JSON['stringify'](_0x2f4b53[_0x44869d(0x140)][_0x44869d(0x154)])):logger['debug'](_0x44869d(0x128)+(_0x2f4b53[_0x44869d(0x13c)]||_0x2f4b53));const _0x4b68fa={};return _0x4b68fa[_0x44869d(0xfb)]=_0x203cd5[_0x44869d(0x121)],_0x4b68fa[_0x44869d(0x13c)]=_0x2f4b53[_0x44869d(0x13c)]||_0x2f4b53['response']?_0x2f4b53[_0x44869d(0x140)]['status']+':'+_0x2f4b53[_0x44869d(0x140)]['statusText']:_0x2f4b53,_0x4b68fa;}})();}}function a89_0xe555(_0x2b71b8,_0x192fbe){const _0x341096=a89_0x3410();return a89_0xe555=function(_0xe555cc,_0x18e0a3){_0xe555cc=_0xe555cc-0xf8;let _0x5ca909=_0x341096[_0xe555cc];return _0x5ca909;},a89_0xe555(_0x2b71b8,_0x192fbe);}module['exports']=TestHubHandler;